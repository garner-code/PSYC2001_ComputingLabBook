# Correlation Analysis

This week, we are going to explore relationships between continuous variables, using correlation. We will take a look at how to combine composite variables into a single score, as this is something we often do in the pusuit of understanding the human psyche. We will also visualise relationships between variables using scatterplots, and conduct Pearson correlation analyses in R.

## Checking installation and loading packages

As usual we first always check and load in our required packages. This week, as usual, we will need the packages `here` and `tidyverse`. 

### Activity - write the code to load packages from the library

Today, we are not giving you the code to copy and paste. You are ready to fly, and write it yourself now you have mastery of the codeship. You are welcome to decide yourself whether you would like to check if the packages are installed before you load them.

Go to your script for the week '05_Correlation-analysis.R' and write the code to load the packages `here` and `tidyverse` using the `library()` function. Write the code to check if the packages are installed if you wish.

```{r message = FALSE, warning= FALSE, echo=FALSE}
# Check if packages are installed, if not install.
if(!require(here)) install.packages('here') #checks if a package is installed and installs it if required.
if(!require(tidyverse)) install.packages('tidyverse')

library(here) #loads in the specified package
library(tidyverse)

```


## Investigating correlational relationships

We have previously looked at how mood and location influence social media use. Now we’re going to look at the relationship between social media use, age and political activism. It has previously been shown that social media use has a positive relationship with levels of political activism in other countries such as Jordan [(Alodat et al, 2023)](https://www.mdpi.com/2076-0760/12/7/402). However, we don’t know if this is true for young adults in Australia. This is what we will test today.

Today we will be using the `time_on_social`, `age`, `polit_informed`, `polit_campaign` and `polit_activism` variables.

Remember, these variables stand for the following:

- age – age in years
- time_on_social – average hours/day on social media (self-report diary)

Political attitude subscales:

- polit_informed – how politically informed they feel (e.g., read news daily)
- polit_campaign – how much they engage in campaign-related discussion
- polit_activism – involvement in activism (e.g., protests, petitions)

### Activity - How might political attitudes relate to social media use?

Before we begin we first need to load in our dataset for today. Are you able to load in the `PSYC2001_social-media-data-cleaned.csv` dataset into a data frame called `social_media`? Again, we will not provide the code, as you can copy and paste the required code from a previous week. Keep flying! :) 

```{r, echo=FALSE}
social_media <- read.csv(file = here("Data","PSYC2001_social-media-data-cleaned.csv")) #reads in CSV file
```

Now that you have loaded the data, take a moment to think about the relationship between political attitudes and time spent on social media. Will young adults who spend a lot of time on social media be more politically active? Or the opposite? Or neither? What are your thoughts?

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What is a reasonable null and alternate hypothesis? Work with your tutor and class to form a hypothesis.
:::

## Building a composite score that measures political attitude

Let's now get an idea of our much political attitude these participants have. We have scores from 3 subscales of a political-attitudes questionnaire. We need to combine them into a single ‘political attitude’ score for each participant. Each subscale score carries a different weighting towards the total political attitude score.

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Pause for thought:</strong> Why would each subscale carry a different weighting? Think about what was discussed in the lectures about composite scores.
:::

### Activity - Get some political attitude

The formula for calculating political attitude is:

$$\mathrm{PoliticalAttitude} = 0.25 \times \mathrm{polit\_informed} + 0.35 \times \mathrm{polit\_campaign} + 0.4 \times \mathrm{polit\_activism}$$
Now you have this formula, are you able to write the code that creates the political attitude scores? 

**Your first hint** is that you are able to take any variable (column) from a data frame and multiply all the observations it contains by a single number. Let's go through an example so you can see what we mean. To go through this example, we need to access the observations that are saved to a variable (column), so we can see what happens when we multiply them by a single number. If you remember, we accessed observations in a column, back in the day, using the `$` operator, when we performed a paired-samples t-test in Section \@ref(sec-conducting-paired-t-test).

Run the following line of code in your script, to see what is printed out into the console. Check it matches what you see below.

```{r, access numbers using dollar symbol}

social_media$polit_informed

```

You can see three lines of numbers. Those are the numbers contained in the column of the data frame that is called 'polit_informed'. The numbers in square brackets at the start of each row tell you which item in the column starts the row. For example, the first number you see in a square bracket is a [1]. This tells you that the number following it is the first number in the column, or in other words, the number following it is on the first row of that column. **Count how many numbers are printed out in the first row of numbers in the console**. Then check what number is in the square brackets at the start of the second row.

Now, we get to see one of the powerful things about R. You can compute operations on large amounts of numbers very quickly and efficiently. For example, you can multiply all the numbers in the column `polit_informed` by 2, with a single line of code. Try running the following line of code in your script:

```{r, multiply polit_informed by 2}

2 * social_media$polit_informed 

```

Compare the numbers printed in your console to the ones above. You should see that they have all been doubled with one mere line of code. Mua ha ha.


OK, we are well on our way to having most of the ingredients we need to make our composite variable. We know now that we can multiply all the numbers in a column by a single number, and that we can add the numbers between two columns. So here is how we would start putting together our composite variable, given the equation we saw above:

```{r, partial composite variable, eval=FALSE}

0.25 * social_media$polit_informed + 0.35 * social_media$polit_campaign

```

**Check yourself!** Does the output match what you would get if you did the calculation manually?

We have been using the `$` operator to access columns in the data frame, so that we can see what happens to the numbers inside the column when we apply operations such as multiplying and summing. This kind of approach is essential for working out how code works. However, what we ideally want to do (now we know what the code does) is create a new column in our existing `social_media` data frame that contains our brand new composite score called `polit_attitude`. To do this, we return to using piping, supplied to us by the wondrous `tidyverse` package. We can also use the `mutate()` function that we used in Section \@ref()

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> Use the mutate function !
:::
  

```{r Activity 4}
social_media_attitutde <- social_media %>% 
  mutate(attitude = 0.25*polit_informed +
                    0.35*polit_campaign +
                    0.4*polit_activism)

```

Lets save this data so that we can use it next week: 

```{r}
write.csv(social_media_attitutde, file = here("Data", "PSYC2001-social-media-attitutde.csv"))
```


## Activity 3 - looking for straight lines

Now lets visualise this in R. 

We’re going to explore our data to see if it is suitable for a pearson correlation analysis. Remember, we use a pearson correlation analysis when we think a straight line is a good enough description of the relationship between our variables.

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="MFW people don't visualise their data"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Correlations_in_R/No%20visualisation%20is%20bad.jpg?raw=true")
```


Let's use `ggplot` to  make scatter plots to show the relationships between age, time_on_social and attitude. You should wind up with 3 scatterplots.

```{r Scatterplot of age and time_on_social, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = age, x = time_on_social)) +
  geom_point(colour = "orange") +
  labs(x = "Age", y = "Time on social") +
  theme_classic() 
```

```{r Scatterplot of age and attitude, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = age, x = attitude)) +
  geom_point(colour = "blue") +
  labs(x = "Age", y = "Attitude") +
  theme_classic() 
```

```{r Scatterplot of time_on_social and attitude, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = time_on_social, x = attitude)) +
  geom_point(colour = "red") +
  labs(x = "Time on social", y = "Attitude") +
  theme_classic() 
```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Do the relationships look linear or non-linear? Which correlation analyses would you be more cautious about running?
:::
  
## Conducting correlations

Let’s find out if there is a statistically significant correlation between `time_on_social` and `attitude`. To do this we can use the `cor.test()` function. This function takes in a formula 
of where the right hand side specifies the two numeric variables to be correlated.

```{r Correlations between time_on_social and attitude}
cor.test(formula = ~time_on_social + attitude, data = social_media_attitutde, use = "complete.obs") #formula contains both numeric variables on the right hand side.
#use = "complete.obs" removes all NA values from the correlation. 
```


::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Have a look at the output in the console. What is the relationship between `time_on_social` and `attitude`? Can you reject the null hypothesis? Was your hypothesis supported? What does the ‘df’ value tell you about the sample size? Why is it that number?
:::


## Writing up results and conclusions

Now lets have a go at writing up the results of the correlation that we have conducted: 

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Results:</strong> A pearson correlation was performed to evaluate the relationship between political attitude and time spent on social media. It was found that there was a strong positive correlation between political attitude and time spent on social media (r(56) = 0.51, p < 0.01).
:::

Please have a go at writing the conclusion:

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Conclusions:</strong> Your conclusion will go here !
:::

## Activity 4 - Exploring the data

Now we can harness the power of R to perform multiple correlations all at the same time ahhhhhhhhhh !

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> First what other relationships do you think could exist between variables in this dataset ? Make two hypotheses and discuss them with your tutor.
:::

Create a scatterplot of the variables you have hypothesised using the code blocks below:

```{r Scatterplot 1, eval = FALSE}
social_media_attitutde %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

```{r Scatterplot 2, eval = FALSE}
social_media_attitutde %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

Now compute correlations between these your chosen variables. 

```{r Correlation 1, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```

```{r Correlation 2, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```

## Writing up results and conclusions

Have a go at writing up the results and conclusions for the correlations you have just conducted. Make sure to use the previous results as a guide.

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Results:</strong> Your results will go here !
:::

Now have a try at the conclusion. 

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Conclusions:</strong> Your conclusion will go here !
:::

## You are Free!

Well done guys you have survived another computing tutorial! Next lesson we will be conducting linear regression on this data. 


```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="It almost over (I promise)"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Correlations_in_R/Statistical%20trauma.gif?raw=true")
```




