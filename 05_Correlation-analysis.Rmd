# Correlation Analysis

This week, we are going to explore relationships between continuous variables, using correlation. We will take a look at how to combine composite variables into a single score, as this is something we often do in the pusuit of understanding the human psyche. We will also visualise relationships between variables using scatterplots, and conduct Pearson correlation analyses in R.

## Checking installation and loading packages

As usual we first always check and load in our required packages. This week, as usual, we will need the packages `here` and `tidyverse`. 

### Activity - write the code to load packages from the library

Today, we are not giving you the code to copy and paste. You are ready to fly, and write it yourself now you have mastery of the codeship. You are welcome to decide yourself whether you would like to check if the packages are installed before you load them.

> Go to your script for the week '05_Correlation-analysis.R' and add the code to load the packages `here` and `tidyverse` using the `library()` function. Write the code to check if the packages are installed if you wish. Make sure to run the code.

```{r message = FALSE, warning= FALSE, echo=FALSE}
# Check if packages are installed, if not install.
if(!require(here)) install.packages('here') #checks if a package is installed and installs it if required.
if(!require(tidyverse)) install.packages('tidyverse')

library(here) #loads in the specified package
library(tidyverse)

```


## Investigating correlational relationships

We have previously looked at how mood and location influence social media use. Now we’re going to look at the relationship between social media use, age and political activism. It has previously been shown that social media use has a positive relationship with levels of political activism in other countries such as Jordan [(Alodat et al, 2023)](https://www.mdpi.com/2076-0760/12/7/402). However, we don’t know if this is true for young adults in Australia. This is what we will test today.

Today we will be using the `time_on_social`, `age`, `polit_informed`, `polit_campaign` and `polit_activism` variables.

Remember, these variables stand for the following:

  `age` – age in years  
  `time_on_social` – average hours/day on social media (self-report diary)  

Political attitude subscales:

  `polit_informed` – how politically informed they feel (e.g., read news daily)  
  `polit_campaign` – how much they engage in campaign-related discussion  
  `polit_activism` – involvement in activism (e.g., protests, petitions)  

### Activity - How might political attitudes relate to social media use?

Before we begin we first need to load in our dataset for today. 

> Copy and paste the code from a previous week that loads the `PSYC2001_social-media-data-cleaned.csv` dataset into a data frame called `social_media`. 

> Run the code and check that the data is loaded correctly using your preferred method from Section \@ref(sec-data-view).

```{r, echo=FALSE}
social_media <- read.csv(file = here("Data","PSYC2001_social-media-data-cleaned.csv")) #reads in CSV file
```

Now that you have loaded the data, take a moment to think about the relationship between political attitudes and time spent on social media. Will young adults who spend a lot of time on social media be more politically active? Or the opposite? Or neither? What are your thoughts?

::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What is a reasonable null and alternate hypothesis? Write it down as a comment in your script.
:::

## Building a composite score that measures political attitude

Let's now get an idea of our much political attitude these participants have. We have scores from 3 subscales of a political-attitudes questionnaire. We need to combine them into a single ‘political attitude’ score for each participant. Each subscale score carries a different weighting towards the total political attitude score.

::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Pause for thought:</strong> Why would each subscale carry a different weighting? Think about what was discussed in the lectures about composite scores.
:::

### Activity - Get some political attitude

The formula for calculating political attitude is:

$$\mathrm{PoliticalAttitude} = 0.25 \times \mathrm{polit\_informed} + 0.35 \times \mathrm{polit\_campaign} + 0.4 \times \mathrm{polit\_activism}$$
Now you have this formula, let's build the code that creates the political attitude scores step by step, and test that its working properly.

The first operation we need to do is to multiply each observation in `polit_informed` by 0.25. 

> Examine the data frame using the head() function (or using another method if you prefer). Take the first 3 observations from `polit_informed` and multiply them each by 0.25. What are the 3 results that you get? Write them as a comment in your script.

Now we know what answers we should get, we can write some code to multiply these observations by 0.25, and check the code works.

Remember, if we want to create a new variable in a data frame, then `mutate()` is a very handy function to use.

Here is the code from Section \@ref(sec-new-likes) that gives a good example on how to use the `mutate()` function.

> Copy and paste this code to your script, but don't run it. We're going to change it for our current purposes.

```{r, mutate eg, eval=FALSE}

social_media_likes <- social_media %>% 
  mutate(likes =(bad_mood_likes + good_mood_likes)/2 ) # creates a new variable called likes which is the average of bad_mood_likes and good_mood_likes

```

> Amend the code that you copy and pasted in your script, so that you save the results to an object called `social_media_test`

> Now amend the code so that you make a new column called `test` (instead of `likes`) that takes the variable `polit_informed` and multiplies it by 0.25

Hint: You multiply in R using the `*` symbol.

> Run the code and then run `head(social_media_test)` to check the results. Compare the first 3 values of the variable `test()` to the results you got from your manual calculation.

The next thing we need to do is multiply `polit_campaign` by 0.35, and add it to the previous result. 

> Using the console, calculate yourself what values you should get if you take the first few values of `polit_campaign`, multiply them by 0.35, and add them to the first few values you got from multiplying `polit_informed` by 0.25. Write these results as a comment in your script.

Now lets amend our mutate code to perform this next step. 

> Using the code you just wrote, add `+ 0.35 * polit_campaign` to inside your `mutate()` function call. Check the contents of the `test` variable to make sure the first few numbers match your own calculations.

Nice work! We now know that we are on the right path to completing the calculation of the composite scores for political attitude. We created the data frame `social_media_test` as a kind of scratch pad for testing. But we don't need the results of those tests to complete our analysis. So let`s remove it from our environment, in a bid to keep the environment tidy.

> Run the following line of code to remove the `social_media_test` data frame

```{r, test remove, eval=FALSE}

rm(social_media_test) #removes the specified object from the environment

```

Now lets properly create the political attitude scores, and save them to an object that has a useful name for our analysis.



```{r}
write.csv(social_media_attitutde, file = here("Data", "PSYC2001-social-media-attitutde.csv"))
```


## Activity 3 - looking for straight lines

Now lets visualise this in R. 

We’re going to explore our data to see if it is suitable for a pearson correlation analysis. Remember, we use a pearson correlation analysis when we think a straight line is a good enough description of the relationship between our variables.

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="MFW people don't visualise their data"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Correlations_in_R/No%20visualisation%20is%20bad.jpg?raw=true")
```


Let's use `ggplot` to  make scatter plots to show the relationships between age, time_on_social and attitude. You should wind up with 3 scatterplots.

```{r Scatterplot of age and time_on_social, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = age, x = time_on_social)) +
  geom_point(colour = "orange") +
  labs(x = "Age", y = "Time on social") +
  theme_classic() 
```

```{r Scatterplot of age and attitude, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = age, x = attitude)) +
  geom_point(colour = "blue") +
  labs(x = "Age", y = "Attitude") +
  theme_classic() 
```

```{r Scatterplot of time_on_social and attitude, warning=FALSE}
social_media_attitutde %>% 
  ggplot(aes(y = time_on_social, x = attitude)) +
  geom_point(colour = "red") +
  labs(x = "Time on social", y = "Attitude") +
  theme_classic() 
```

::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Do the relationships look linear or non-linear? Which correlation analyses would you be more cautious about running?
:::
  
## Conducting correlations

Let’s find out if there is a statistically significant correlation between `time_on_social` and `attitude`. To do this we can use the `cor.test()` function. This function takes in a formula 
of where the right hand side specifies the two numeric variables to be correlated.

```{r Correlations between time_on_social and attitude}
cor.test(formula = ~time_on_social + attitude, data = social_media_attitutde, use = "complete.obs") #formula contains both numeric variables on the right hand side.
#use = "complete.obs" removes all NA values from the correlation. 
```


::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Have a look at the output in the console. What is the relationship between `time_on_social` and `attitude`? Can you reject the null hypothesis? Was your hypothesis supported? What does the ‘df’ value tell you about the sample size? Why is it that number?
:::


## Writing up results and conclusions

Now lets have a go at writing up the results of the correlation that we have conducted: 

::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Results:</strong> A pearson correlation was performed to evaluate the relationship between political attitude and time spent on social media. It was found that there was a strong positive correlation between political attitude and time spent on social media (r(56) = 0.51, p < 0.01).
:::


## Activity 4 - Exploring the data

Now we can harness the power of R to perform multiple correlations all at the same time ahhhhhhhhhh !

::: {style="border-left: 4px solid #33a02c; background-color: #a6cee3; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> First what other relationships do you think could exist between variables in this dataset ? Make two hypotheses and discuss them with your tutor.
:::

Create a scatterplot of the variables you have hypothesised using the code blocks below:

```{r Scatterplot 1, eval = FALSE}
social_media_attitutde %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

```{r Scatterplot 2, eval = FALSE}
social_media_attitutde %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

Now compute correlations between these your chosen variables. 

```{r Correlation 1, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```

```{r Correlation 2, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```


## You are Free!

Well done guys you have survived another computing tutorial! Next lesson we will be conducting linear regression on this data. 


```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="It almost over (I promise)"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Correlations_in_R/Statistical%20trauma.gif?raw=true")
```




